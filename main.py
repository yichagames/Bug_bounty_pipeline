from utils.log import log
from utils.script_exec import execute
import traceback
from flask import Flask, render_template, redirect, jsonify, request
import handler

app = Flask(__name__)

@app.route("/")
def index():
    return render_template("index.html")

@app.route("/api/doc")
def doc():
    return "this is still underconstruction <br> <img src='data:image/jpeg;base64,/9j/4AAQSkZJRgABAQAAAQABAAD/2wCEAAkGBxIQEhUQExMVFhUXFRUXFxUXFRIYFhUYFxYWFhUXFRcYHSggGBolGxUVITEhJSkrLi4uFx8zODMtNygtLi4BCgoKDQ0OFw8QFSsaFR0tKysrKy0rKy0tKy0tLS0tLTcrLS0rNy0tKy0tNzctKzc3KystKy0tLSsrNysrLSsrK//AABEIANsA5gMBIgACEQEDEQH/xAAcAAABBQEBAQAAAAAAAAAAAAAAAQMFBgcEAgj/xABBEAACAQMDAgQFAgQDBgQHAAABAgMABBEFEiEGMQcTQVEUIjJhcYGRI0JSoRUz0WJysbLB4RZzg5IIFyUmNHTC/8QAGgEBAQADAQEAAAAAAAAAAAAAAAECAwQFBv/EACIRAQEAAwABBAMBAQAAAAAAAAABAgMRIQQSEzEFIlFBFP/aAAwDAQACEQMRAD8A2vFGKc20baqm8UYpzFGKBvFGKc20baBvFGKc20baBvFGKc20baBvFGKc20baBvFGKc20baBvFGKc20YoG8UYp3FGKBrFGKdxSEUDeK8kU7ijbQNYoxTu2kNA3ijFe6QmoPOKMUZpd1T3QJiivVLV6Ha8u2ASewGf2pRQaIxbQdS1bqOSeaC9+Bto3CoqJuc55G7BBJxjJ3YyeBUt05q2q6fqSaZeu13BKoMdyI2yhO7buYD3UghiSMgg47tah4a3llcSXei3Yi3nLW7/AEHknAOCrDngMOMnmuvo/wAQrr4waVqluIblh/DdPok4JGRkjkA4ZTgkYwKC/avrltZqHuJ44gTgeY6ruP8Asg8n9KNH1u2vFL288cqg4JjdW2n2YDt+tZH0tpseta3qE14vmpasYoomyUAEjouR6gCNjjtlyaOo9Pj0XXbCWzXy47phHLCuQh3SLG2B6D51bHoVoNXuepbOJ5InuoFeJd0iNKgZF+XlgTkD5l/9w968L1TYlIpPiods5IhJkUCUqwRgmT8xDEDj1NY/N07BqPVN3BcAtGEWQoGK7ysMAAYjnGWzwR2Fe/GvQoYW0iyhXy4vMnQBSSVEkluWILEnOWJoNYbrLThvzeW4CMEcmVMKzbiqk5xk7H4/2T7VKPfxCL4gyIItm/zCw2bMbt+7ttxzmqNrnhnZx6bdWtpDseSNSDvdmeSHLxZ3E4JJI4x9RrPLnq8ydMR2wJMzTCzwO+1CJRx6jZ5ace9Bvem6jDcp5sEqSoSQHRgykjuMjisy8b9fvLWWwjtbhofOaZWK45w0AUnI9N5/er50ZoosLG3tB3jjAbHq5+aQ/qxasw/+IcMZ9MCEBt8+0nsG3W+Cftmg6+odI1/TreS8XVRMIRveNolGUH1Y3Ag8enH5q6dH9YJdabFqNwyQggiVmYLGrq/lkgseAWxgE/zAVQ+u9C6iezl8+8glhVS8sUK+W7ovzMAfLGeB2zz9+1Jq+oW0/SUhtYzFGvkoYydxVxdRF8tgbsk7s4Gd3YdqDUYep7J5I4EuYWklXdGiupZ1wWBAHpgE/gUmrdVWNo3l3F1DE+AdjSKGwexK9wPvWe+H/SlnZ6ZHq4iL3SW0s4kZ34Ijf5QoO3bt47VxeDvSVtf2suoXsa3M00zgtL820DGcD+okk5/AFBsFlexToJYpEkRuzowZT+COKfrGvDiP/DtevtKiY/DFPMVCSdrbYnXGfZZCue5wue1bLQFeTSmkoCiiiqorwxr0TUff3gjGawzymM7Vk6euJwo5NRk2ok9qjJbxpDn+1KHr5/1f5DLvMHVho/rt+NavceosO/NR3mCkE1cE9Xu/rd8OKfhvgaKgDLSV1Y/kdkn2130y6U1d2yyxvE4yrqyMPdWBBH7GnKUV9Q4mOaFo+taAZbe1to761dy6HeqOpIC8gkEHCjIwRxwRXTonTGpajqsWrahElskCgRwqwZ227ig4J43OxJJB4Ax6jW6KiMn1PpvUdL1KbUtNhW5hucma3LhGDE7mIyR/NkgjP1MMetetH6b1HU9Ti1PUoUt4rcDybcMHYsMlScE4+Y7iTg/KBjHNatRQZpo/Td2nUd1ftERbSRbUl3JgnZAMbQdw5Ru49KTxb6au72502S3iMiwSu0pDINgLwEHDEZ4Ru2e1aZSUBXz7pXSIPU0lsp3QQzG7K5+VchZFXA4yHdF/Arb+pLGe4tpIbec28rbdswXcUwyk8fcAr+tQfQHQw0zzZXma4uZ2zLOwIJwSQoBJPckkk8n8CguFZZ41dNXt7JYyWcHnGBpmYbo1AJaEoDuYZzsPb2rU6KDJNYv+pb2F7UafDAsqlHl86MlUYENj+IccHuATXTf9Az2/T0umQgTXDmN2CkKGfz4nbaXIGAiY5xnb98VqVFBW+itJeLTLe0uE2sIPLkQkHGQQwyCR2NUDQdM1nQDLa21qt7au5eJ/MVGUkAfMCcjgLkYxnkHvWxZFLQZv4a9H3cVzcatqG0XVwCojUgiJCVJBIJGflRQATgL3JJxpFFFAhpKU0lVRRRQTQNSmqfr18Gfb6CrXdPhSfYGsya53sx/2j/xrzvX52Y8jfox7UrFPxXr4iuCGXive6vncsb13/Tq82jzK5GevPm1j7KvY7xLRXEJaKvtqtNpRSUor7R45arXW3UD6csV0cfDh2WfglgGjYxMpHb+IqL2P11Zai9e0cXipG7ssayJI6KExL5bB1RyQSF3KpOME4x2qIpcvVV/GsrSPAr2oshLAYzune4CNJ5bbwUGXKJgHLRtnPYdMnWE4VMGPcbzUYSMc7LaO6aPjPfMUeT9/vVzn0uCSRJ3hiaVPokaNC6f7jEZX9Kj7ezsJbmfbbwm4jKea5gTfmSM7cyFctlGYd+xIoId9bvItH+PeSJ52iilXERWNfM8vCFd5LY3HnIz7CuC46g1CGWZWmgdbe7soWAt2UyJdGENz5h2FfN475xzV7eyiaPyTGhjwF8sqpTauNo24xgYHH2rzJp0Lbi0UZLMjMSinc0ePLZsjll2rgntgY7UGcHri/MVxciNRGsd8VBWICJrcsIufOLyk7CGBRcFh2A56L3qTUYGud01u4tks5SBbsvmC5cq0efNOwLtYg8nke3N5bQrQtJIbaAvKpWVjFHulU8FZDjLggDg07LpsDbt0MZ3hVfKId4QkoGyPmCknAPbNBTtE6ovbi82+Wvw/xNzbsuIwUEO8K4cy73clMlfLHD8dsnxqus3EVxdpbiPf8TaR/wApkZWtt7+WkkirJKMcLkcAnkjBtvwdotyJPLgF06MQ+yMTsi7Qx3Y3FRuUH8inrrSbeUOskETiQqZA8aMJCowpcEfMQAMZ7UFdbqGZtLF3E8LzEhAzL5SM/neUwCSOMScMAhcAvgZwah7fWbme5sR8TgfEXcU0fkmMkxxb9kq7yN4BAypK9mHtV9OnwmL4fyo/J27PK2L5e3+nZjbt+2KjLaDT3EEUcMDIC0sASFWiRomAZ0ZV2I4ZvcHvjsaDLmujLAshAUtp+jthd2BnVH4GSTj8k1ttcI0a2A2/Dw42omPLjxsjbfGuMfSrEsB2BORXdQFFFFB5NFFFVRXFqt4YYzIFLY9B3rtpGFBjvUHijKu5BbsvcZOaz+XruReygV9IXumwyfXGjflRWQ+Mmg26JH5MSKxJ3bQAa59mvHK/s2YZWfSinxBn9Av7Uf8AzDufYftULHorH0NSFtoo9q1XVon+M/fmkYOu7t+yj9qlbXqi6buorgsun89qm9N0QqRmubZ8EniNuPvdlvq9y3ZAaSrFZ2wXiivNuzDv03+WrUUUV9Q8wVnksN0Lgw+TcH/6sLjzAGMXw5hAHz5xjd3X0PpWh0UGSwdP3sdtD5KXCyvpjrcfPLuaUTWx2Es2Fl8vz1XsRnAwKLrR58zNbW88ds1zas0bxzMzxLbup/hCVZHQS7CUDA8diODrVFEZ/wBJ6FMLqF5/PdIrUmNpPMjCubqYopj8x8lYmUDeSduM4OQH7yxkN/K8sN07Ga2a1liciKKJVTzAx3bVAcSl1Iy4YAZ4xeaKDJTpV78O6pDdLc/B3q3bszlbiZl/gmI7sOS+WUqBtXjjOK7tR0KaNriONLkQMLBxtEkymRTN55eMyB5VOIt6q248d+a0yiisrXRZs28xtJVf4PUYVIMzlHZgbcncxaJWTftVidu4L6CuifTJ7WNBHDct5mlSxEIZJGF04jYmQs2VJ5+Y8DBFaZS0RnGn6ZIZ8XMF28ha18mRHZY44BbxrKkh3bVAfzt6Ebm3DGeCIzTdFvYreOG3ilhkS21VDnKr57vF5DBiccqPlbtwfvWtZpKKy59JmclbeC6itmk00NHI0quXW4Y3TrliwXyigZgQGIyCe9XHouyeBLiJldUF3N5KsWOIjtK7NxzsyWxVgooPVFIKDUQlFFFVRXljXqvLig4r+cIpc9gM1j2tzNdSOx7Z4+wrQevrwxwbQeWOKxzXdSa2ChTy3NcO+5ZZcxb9fJOpJ9O2CnbGwUnJpmCV5LZZc96r+r6jLDLsDHgDP61zzRsvhtueMaNYWiius2wFeenLdJrdJGzkgZ5rrvrfYMqc1zbfR7J56zw2ymI1opmKXPNFefcb1vkjVKTNVGXqeYMVaIpgkciud+pZT7V9e8ldtwoDVRX6gmPqKabXJ/6qC+lqXdWbza1Nj6jVN6l6wvYs7JCKDegwpa+bdI8R77d80mfyK1DpzrgygeZjNXg0OiouHWY29a6Y75D2IqDrorwrg16BoFooooCiiigKKKKAopM0uaAry5r0a8MalGeeI0u5kT2BNUG906G6wJGKsvY+4q8dbDdPj2AqnXFmSa8u75js8uvHX3F2vGiwiCPsB+9Rkum285DSghxwfTOKkrW3xXS9kH7il9dJkfB4d1pqSIoReAAAP0p2S9LjArgg0wDnFSEVpite/wDIY5Y8hr02UkK8UU9txRXkW23runONFurNZAQwqnavo7QncBlf+FXvFNTRBhgjivsHjM0x9qQ1Oa9pBiJdBlT6e1QYNB4dapPWNvkNiruxqs9VrmMmshmdq216ntN1IqxOTVdlcK+achuuDWNRq1hrLbVO41Jw62w9T+9UDRLzcuM1KwT4NFXWDqOQdmNdkXWciDnDVTI56c3cYoNDseuYWIDgqff0qyWupRyDKuD+tYv5Ve43dOVYj8Gg3ANS5rJtN6quYiAW3D71Z7brqI4DqQfU0FzzXhnqqal1rFGu6NTIfYVCt1rd4yLNyPwaDQjLVV1PrZIJTGy9jg1XV8VYkO2WJ1I7g1C9U9RWd9GZI1Ky54P+tBquka9DcgbHBOO3rUk9fOmkahJbusqseD2HrWxdJdWpffJjDgcilgrHW0pW6OPYVDJer/OMVY/FKxIVLheMcN+KoEGpEd+a8f1Gj9nbrz5OLRbXsRHcU8b+Jec/tVcTUkPcD9q6P8YjC/Sv7CuPLRetnyYxNf4zH/KCf0Nel1R27R/vVe/8Qp9hXk6yG/mrH/nv8PmxqUn1ko2HGKSoG8PmkH2+9JXRj6fHnmMLsn9fRJNRuqa5BbDdLKiD7kVUfFHr1dNjEcfM7fSP6R7mvnHWdYnu3MkzsxJzyeB+K9/jhfQ+qeLmmxkruMnp8o4qq3XiLp0hyu9PsRxWKxwluwp34J/aiNzsdZgnH8ORT9vWuPqNMxk1jEbyRHcCVP2rQOk+pvih8LN9RGFb3P3q9XqI/wAC84llNcM+gSqcYqzxo9pcNHICFJ4OOKm5cMN3FRFI01HhbDCp8ScZFe9Qttynioi2utp8tuD6UVOw3FdaT1DB69rcYoJxJacEgqFS5p9Lqglsg0jLmuKK6FPpPRDoTHbipC31aeMYDZGMc+1cSPnvTgYGiobVdKExLEkEn15qHu+nGT6W3D7f6VcHUVyzyBBmpRVoYGTg5/WtA8LtJkaU3PZBx/vVGaNpL3hZ3ISJe7H1/FWW46zt7OMQW43lRjI7E1OxLZFx6htEmgeNyACD39D6VgVzHsZlyOCRn3q6x22pamcnKxn8gY/FOdQeHRjg8yNi7ryw9x9q0bMfd5JnlfEULfXtIc9zTcb4OCMEcEGukVx5Syt+GEv2RrNPauObT19CR+tdTz4rnluaxx71tuOJ/RXERYMc/miuKGPzCaK7MZONNjv8Q57eW+mMhbcHI/GPSqv8LbE8E1KeJ1m0OqTK38zbh+DyKrli43EH9K6L1osTCW8WOCa9iJO2a8ROVHamyDkN9+1Y3rC9e7q0Ugg1wQ2Wxg6ShSDkHPIqUnlyD+KrJy77V7k4FXHq49W2bVruQYeXePuK5l1G6Tswr6C6N6YhSygWWFC+wbiQM881JydLWZ728f8A7RWfln5YHputbwRMcH7Dg15vFglz8xyPXFWrxe6bjtTHNCmxScEKOM96tHSXStldWscpjG5l+Y/epejHI5inG4MP716XUkz7VrnVfQthbW0k+GXapI59fSs+6B6Q/wATLsTtVexx61J0RiXAbsaZN05OBmrL1F0HdWH8UEPH7gdvzT/SWj/G5RZVVxzgqDkVmK4HkWn4tSI7g1oFx4dXIOVaNhj8VFXXRd4neAN/ukGioW2vw3836V3Qz/eoDXtOlgPzQSIR3OOKatZ2KqQSxJ7e1EWpZc92AHqScAVEdR38PEcDM7/zEdj+KkNH6OvL05fKx/f/AErR+mvD62tfmKh39zz/AGrG0Z1ovT1/ehVO6OMY75A/atF6d6Ft7bBYb3Hq1W2GADgDA9hTypipxPabhiAGAMUrJTwrxJV4vFI6p6AhusyR/wAOT3HYn71l2tdM3doTujLL/UoJFbJ1frb2UPmou7nBFUW48Spjx5KHj15rDLVK2Y5cZq8zeqkfoa5mkZjgAn8A1vnSZhv4BPJbxg5IxtHpT2qTafYkGSONM9vkHNa5pX5Kw+y0S8cbkhfHvgikral6608fKG7ey0lbZrY+5C+NXRb3ka3UC5lj4YDuy/8AavnqWF42IYFSDz6GvtcrVX6j6Csr3l4wG/qUYNZxi+W7bUmX6ua6Tqq+1a3qfgghJ8qbH2IqNi8DJM/NcDH2FLInIyq4v2fgVo3hN4fSTyrdzoVjU5UEfUff8Vo3S3hXZWnzsvmv7t2B+wq/wQBQAAAB6Ck8LwiR4GBSFcU/igir0UTxXsPNsHPqpDVGeCN6HtHQnlHxj+9XvX7ETQSRf1KRWQ+HF18Bdy2svyhicE8cipTqf8cNT8u0WEHl2/tUh4N6b5VgrH6nJY/9KoXX99/iN8kEfzKpC8c+vNbZodkIIUjAwFUCoh6+sxKjI3IIwawG7jk0rUCoJChsj7qTX0Sax7xlsMPFOP8AdP8A0pStU0q6EsauD9QBrt2VRfC/U/NtVQn5kODV7zSXwRUvEeZUs3zjJ4H61T/DHpxZG86QZVew9z710+KmoeZNFar+T+tXjpPTxBbouMHGT+tY1KmIoQBgU6FoFLWUZCiiiqA1UOp+p/hj5Y+oj9qt5qpa/wBI/EymXdjI7UGbazrc8+Q7kqfT0qCcclq0y48PXPZ1/vVY1LouSMkbs49gavRN9E69HBabXbBDHioPrbW1vtiohwp7moI2kkTFcNj8Guhd3sf2NXojE0ptxP2oqw2lq79lP7GlrEbrRSijFA2VryY6dooG1WnBRRQFFFFAhFU/qfoOG8fzclH9xVxooKd010Db2beZy7/1GreFr1RQecVVuvtD+LtmQfUBkfpVrrw6ZqUYh4Y6r8NctC5xk4/UVs0l2oQvngDNZR4gdGSQSm8twSpOWUdwahv/ABDeTR/DqpGRg8HNT6Y/TpspfjtSMh7F8L+Aa223jwAKz7oDpNocTSDB9BWjIKkJ0tFLilrJSYpK9UhoEoxRRVUhFcFxp4fuKkKMUEV/gkXqoP6Uh0KH+hf2FS1FBHw6XGvZQP0oqQooFFLUfrOrw2cTTzyBEX1PqT2AHck+wqF0zr2znkSHMsTScR+dDLEsh9kZxgn7VEWmlrzRQeqK80UC4oxSUxd3kcQUyOqbmVF3EDczcKoz3J9qqujFGKTNBNAuKMV5zTd3dLFG0rnCopZiAScAZPA5NA9ikIrittXgk8oLIu6aPzI0PyuyAAlgh54yM+2aevL2OFfMldUXKjcxCjLEKoyfUkgfrUDrRA8HkUyunxDkIoPvtFNyapGs6WxJ8x0Z1G1sbVIBy2MA8jgmuyiPKx4r3XkmjNVXqlpvNcup6jFbRtPM4SNRksx4/wC5+1OHHdSGqxoHXdhfSeTBPmT0RlZC2O+3cOaNe66sLGTyZ58ScZVVZiue27aOKcFmorj0zUYrmNZoXDxsMhh2P+h+1cfUPU1rp6h7mUJu+kYJZvfCjk0ExRUP071Paagpe2lD7fqXBVl9sq3OPvR1D1Pa2AQ3Moj3kheGJOO/Cg+9BMUV5ikDKGHIIBB+x5FeqAooooKL1mok1XSopeYt1w4B+kyog8vI9TgtirPr9hbTxhbkL5aujAs23a6sChDZGDnFNdTdPRX8YjcsjIweKVDiSJx2ZD/09ahh0XLM0fxt9LdRxsHWExxxozL9LS7OXwecdqB/pXUpZbrUo3cssVwixjj5FMKtgfqc1TtN1e+u102EXckZna/EsihCxWJvlxkYBA4Bq33fR7/EzXFveSW4uNvnxqkbBiq7dyFvobbxkV50PoWO1NmVmdvhPiNuQPn8/vu9sf3oIvN0+o3Fv8ZMsFrb2su0eXulO19wdivAbac47/aqvD1ReTW/x8dxfG4YmRLVLR2tCu7iLcEy2V/m3d61K20FUu7i83EmeOKNkIG0CIMOD653VBx9CyIpt4r+eO0LFvIUIGUFtxjSb61TOeB2BoI63N5qF/dQi7mtoY4rZwkYTeryR7iMspwAc5HvVc1aa4vLC1M1xJ5kWqC2LrsG/bMUWVhg/OAOPT7VqGmaAsFzcXQckzrCpU9l8pSowe5z96h5ug0Nq1ss7qfi2u0kCqSkhk8wDaeGAPFBJ9RwTpYSrBK/nJCSkhxvZkGQWwMZOOePWqfc9YTSXVnPE+LVY7Y3I4wzXhKx5PoVIB/WtHt42CKrtvbaAzbQu44wTtHbPtVTsPD2GG0ubMSORcMzbyBuj7eWE+yYGKqoabXZnt7i4N6YI5L5ooW2F3EMf8Nlt0AOZGZWIODXHpXUU6NfQJcXMqJYtPG9zEY5kcblOMqu5eAe1Wq66IU2trbxzPHJaMHin2qx34IZnU8Nu3HP5puLocmSeaa7klkntjbuxRFCg55RV4GM9qCrQ2stzqGkytdTK0lg0hKlOCqxFgMr2fPzf2xU74y2pewBEjptnt8hcYbdMijdkencfcVJydHYNlJFcNHJaR+UG2KwkjKqGVlPYnaORUn1ToS39s9szsmSjB1wSrIwdTg8HkDioiuX13PbXlvbCeR1/wAPunYvt3O6FNjtgDkZPaqyl7qMem2mqfHytLI0CNGyRmHbM/l5KgZLDIOc9xV8bpcvLFcSzl5I7aW3JCKofzcZfAPykYHFNSdFobCDTvNbbC0LB9oy3kuHAI9M4oIZru502+8l7qW5ieznnKyhMq8G36CoGFOTxVateo71oY75J76S4YpIbYWj/CsjEZjRgnop4fd6Vpt/08k13Hdsx+SGaEx4G1llK7iT+n96hbboaWNVt11C4FojArAAgYKDuEfnD59n29uKCxadDOJJZJJQ0b7DFHs2mIbfmDNn5iTVC8e3Is4Fzw1wMj3wjYrQLOxkjllkad3RyuyIhQsIUYIUjk5781nvj3/+Jb//ALH/APDVVRHVumw2mpaQYI1j3eXu2jG75lHPucE/vXnpDTYbvUdXNxGsu3zcbwDt+ZhxnscAftXZ4gHOpaP/AOn/AM6V58PDjUNY/wDU/wCd6I5PDLqUafpU87RvKq3QUIhGfnRe2fxT/U5S813TxIm6N4Y28t+R8wd8EfkD9qkfAPHwdxnGPiPXt9C0x1Of/uWy/wDLX/hLRXnouBYOor2GJQkflthF4Uf5Tdvyx/eqh4ram17dSzL/AJFuy26n0LYLMR+oP7Cpye9eDWdWmiG50tZSoGSd22EDgfmqbqGpAaalmYJVk+IaaSVxhXJDDA9cgEf3oPpfTP8AJi/8tP8AlFdVQvSOp/FWcMwRk3IBtb6ht+X++M1MioFoooogooooCiiigKKKKAooooCiiigKKKKAooooCiiigKKKKAqG6r6ch1K3NtNkAkMrL9SMOzCpmkoM+6b8LorW4S5luJbhov8AKD8KmOx7nt6DtS9SeF0V1cPcxXEtu0n+YqfS/oT3Hf1HatBpKCmS+HkH+HjTY5ZI13h2lGN7MO5PpzR1P4eQ3qQfxZI5YEVEmXG4hQPq/UZzV0pDRVS6J6Fi0wyS+Y800nDSP3xnOAPz3NdXW/SSapCsDyNGFcPlQpJwCMc/mrHmjNUNW8OxFQdlULn8DFOijNGaiFopM0UH/9k='>"

@app.route("/api/<action>", defaults={'value': None}, methods=['GET', 'POST'])
@app.route("/api/<action>/", defaults={'value': None}, methods=['GET', 'POST'])
@app.route("/api/<action>/<value>", methods=['GET'])
def api(action, value):
    if(request.method == "POST"):
        value = request.get_json()
    log(f"api_action: {action}, value: {value}")
    result = handler.handler(action, value)
    return jsonify({
        "action": str(action),
        "value": str(value),
        "result": result,
        "status": "ok"
    })